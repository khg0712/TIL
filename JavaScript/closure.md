클로저 (Closure)
===============

## 클로저란

클로저는 함수와 함수가 선언된 어휘적 환경의 조합이다. 더 쉽게 말하자면 자신이 생성된 환경을 기억하는 함수를 말한다. 사실 클로저는 특정한 함수를 지칭하는 말이 아니다. 자바스크립트에서 모든 함수는 클로저로 간주될 수 있다. 모든 함수는 스코프 체인을 통해서 자신이 선언된 환경에 대한 참조를 가진 바인딩 객체에 접근할 수 있다. 하지만 이 바인딩 객체의 프로퍼티에 접근할 수 없다.

### 일반적인 상황에서의 클로저
----------------------------
우선 간단한 코드를 통해 클로저를 알아보자.

클로저 함수의 간단한 예

    function outer () {
        var k = 'precious'
        function inner () {
            return k;
        }

        return inner();
    }

    outer(); // "precious" 반환 

위의 예시를 보면 outer 함수 외부에서는 접근할 수 없는 지역변수 k의 값을 얻을 수 있다. 이처럼 클로저는 변수의 유효범위를 이용해서 다양한 기능을 만들어낼 수 있다.

예시2

    var inner;
    function a () {
        var inVal = 'a';
        function b () {
            return inVal;
        }
        inner = b();
    }

    a(); // inner에 함수 b할당
    inner(); // 'a' 반환

위의 예시에서는 함수 a가 반환되었지만 inner가 함수 a에 대한 접근이 계속 유지된다는 것을 알 수 있다. 따라서 함수가 반환되어도 해당 함수의 지역 변수, 함수에 대한 접근이 가능하다는 모순(?)을 보여준다.

### 루프에서의 클로저
-------------------

루프에서의 클로저는 새로운 충격을 느끼게 해준다. 여기서도 먼저 코드를 통해서 접근해보자.

우선 반복문을 통해 배열에 각각의 인덱스의 값을 반환하는 함수를 넣어보자


    var arr = [];

    (function F () {
        for(var i = 0; i<3;i++){
            arr[i] = function(){return i}
        }
    }());

    for(var i = 0; i<3;i++){
        console.log( arr[i]() ); // 콘솔에 3이 3번 출력
    }

왜 arr\[0](), arr\[1](), arr\[2]()의 반환 값이 모두 3이 되는 걸까? 함수는 값에 접근해야 할 때 자신이 정의된 환경에 다시 접근해서 값의 가장 최근 값을 가져온다. 따라서 위의 예제에서 각 배열에 할당된 함수들은 모두 같은 변수 i를 참조한다. 따라서 마지막에 이 함수들이 호출되어 i 값에 접근할 때 i 의 가장 최근 값인 3을 가져오게 되는 것이다.

하지만 원래 의도대로 하길 원한다면 다음과 같이 해결할 수 있다.

    var arr = [];

    (function F () {
        for(var i = 0; i<3;i++) {
            arr[i] = (function(param) { 
                return function () { 
                    return param;     
                }
            }(i));
        }
    }());

    for(var i = 0; i<3;i++){
        console.log( arr[i]() ); // 콘솔에 3이 3번 출력
    }